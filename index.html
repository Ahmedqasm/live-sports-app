<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary: #238636; --bg: #0d1117; --card: #161b22; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø«Ø§Ø¨Øª ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
        .header-player { position: sticky; top: 0; z-index: 1000; background: #000; width: 100%; box-shadow: 0 2px 15px rgba(0,0,0,0.5); }
        video { width: 100%; max-width: 800px; aspect-ratio: 16/9; display: block; margin: 0 auto; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
        .search-container { padding: 15px; background: var(--card); border-bottom: 1px solid #30363d; }
        input { width: 90%; max-width: 400px; padding: 10px 20px; border-radius: 20px; border: 1px solid #30363d; background: var(--bg); color: white; outline: none; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
        #channels-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; padding: 15px; }
        .channel-card { background: var(--card); border: 1px solid #30363d; border-radius: 10px; padding: 10px; cursor: pointer; transition: 0.2s; text-align: center; }
        .channel-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .channel-card img { width: 50px; height: 50px; object-fit: contain; margin-bottom: 8px; border-radius: 5px; background: #000; }
        .channel-name { font-size: 11px; font-weight: bold; height: 32px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        
        .loader { padding: 50px; color: var(--primary); font-size: 18px; }
        .error { color: #ff4444; padding: 20px; }
    </style>
</head>
<body>

<div class="header-player">
    <video id="main-player" controls playsinline autoplay></video>
</div>

<div class="search-container">
    <input type="text" id="search-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." oninput="search()">
</div>

<div id="channels-grid" class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</div>

<script>
    /**
     * Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ± - Ù‚Ù…Øª Ø¨ÙˆØ¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª "Ø§Ù„Ø¬ÙˆÙƒØ±" Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­Ø§Ø¯Ø«ØªÙ†Ø§
     */
    const CONFIG = {
        host: "http://xapi-ie.org:8080",
        user: "TEST10",
        pass: "test10"
    };

    // ÙˆØ³ÙŠØ· Ù„ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù…ØªØµÙØ­ (Proxy)
    const PROXY = "https://api.allorigins.win/get?url=";
    const API_URL = `${CONFIG.host}/player_api.php?username=${CONFIG.user}&password=${CONFIG.pass}&action=get_live_streams`;

    let allChannels = [];
    const grid = document.getElementById('channels-grid');
    const video = document.getElementById('main-player');
    const hls = new Hls();

    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    async function init() {
        try {
            const response = await fetch(PROXY + encodeURIComponent(API_URL));
            const json = await response.json();
            allChannels = JSON.parse(json.contents);
            render(allChannels);
        } catch (err) {
            grid.innerHTML = `<div class="error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø¥Ø¶Ø§ÙØ© CORS ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.</div>`;
        }
    }

    // 2. Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    function render(data) {
        grid.innerHTML = '';
        if (!data || data.length === 0) {
            grid.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª.';
            return;
        }

        data.forEach(ch => {
            const div = document.createElement('div');
            div.className = 'channel-card';
            div.innerHTML = `
                <img src="${ch.stream_icon || 'https://via.placeholder.com/50'}" onerror="this.src='https://via.placeholder.com/50'">
                <div class="channel-name">${ch.name}</div>
            `;
            div.onclick = () => play(ch.stream_id);
            grid.appendChild(div);
        });
    }

    // 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø«
    function search() {
        const query = document.getElementById('search-input').value.toLowerCase();
        const filtered = allChannels.filter(c => c.name.toLowerCase().includes(query));
        render(filtered);
    }

    // 4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©
    function play(id) {
        // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        const streamUrl = `${CONFIG.host}/live/${CONFIG.user}/${CONFIG.pass}/${id}.m3u8`;
        
        if (Hls.isSupported()) {
            hls.loadSource(streamUrl);
            hls.attachMedia(video);
            video.play();
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = streamUrl;
            video.play();
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    init();
</script>
</body>
</html>
